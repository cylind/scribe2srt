# Scribe to SRT (Powered by ElevenLabs)

这是一个使用 Python 和 PySide6 构建的桌面应用程序，它可以将音频或视频文件通过 [ElevenLabs Speech-to-Text API](https://elevenlabs.io/speech-to-text) 转换为专业的 `.srt` 字幕文件。

本工具旨在简化为视频添加字幕的流程，特别是针对中文和日文内容，提供了智能的字幕切分和格式化规则，以生成高质量、易于阅读的字幕。

## ✨ 功能特性

- **高效视频处理 (可选, 需安装 FFmpeg)**: 若已安装 FFmpeg，在处理视频文件时，应用会自动提取音频流，仅上传音频，极大地减少了上传数据量和处理时间。
- **拖拽上传**: 支持将音视频文件直接拖拽到应用窗口。
- **多语言支持**: 支持日语、中文、英文的语音识别，并可选择自动检测语言。
- **专业级字幕引擎**:
    - **智能语义分组**: 不再是简单的按字数切分，而是通过分析语音中的**停顿**和**标点符号**，将语音智能地组合成符合语义和说话节奏的字幕块。
    - **自动适配行长**: 程序会根据识别出的语言（中文、日文、英文等），自动采用符合该语言排版规范的**最佳行长**进行换行，无需手动设置。
    - **专业规则集**: 严格遵循字幕制作规范，包括每秒字符数（CPS）限制、最短/最长显示时间等，以确保最佳阅读体验。
- **声音事件识别**: 可选择识别并标记非语音的声音事件（如 `[音乐]`、`[笑声]`）。
- **实时进度**: 显示文件上传的实时进度。
- **日志输出**: 在界面上提供详细的处理日志，方便追踪任务状态。
- **跨平台**: 基于 PySide6 构建，理论上支持 Windows, macOS, 和 Linux。

## 🚀 安装与运行

请按照以下步骤在您的本地计算机上运行此应用。

**1. 克隆仓库**

```bash
git clone https://github.com/your-username/scribe2srt.git
cd scribe2srt
```

**2. (可选, 但强烈推荐) 安装 FFmpeg**

为了最高效地处理视频文件（如 `.mp4`, `.mkv`），强烈推荐您安装 FFmpeg，并将其添加到系统的 `PATH` 环境变量中。

- **如果安装了 FFmpeg**: 程序会自动从视频中提取音频进行上传，速度快、流量消耗少。
- **如果未安装 FFmpeg**: 程序会尝试直接上传整个视频文件。这仍然可能成功，但会消耗更多时间和流量，且成功率取决于 API 对视频格式的支持。

- **Windows**:
  - 从 [FFmpeg 官网](https://ffmpeg.org/download.html) 下载。
  - 解压后，将 `bin` 目录的路径添加到系统的环境变量 `Path` 中。
- **macOS** (使用 [Homebrew](https://brew.sh/)):
  ```bash
  brew install ffmpeg
  ```
- **Linux** (使用 apt,适用于 Debian/Ubuntu):
  ```bash
  sudo apt update && sudo apt install ffmpeg
  ```

您可以在终端或命令提示符中运行 `ffmpeg -version` 来验证是否安装成功。

**3. 创建并激活虚拟环境**

- **Windows**:
  ```bash
  python -m venv venv
  .\venv\Scripts\activate
  ```
- **macOS / Linux**:
  ```bash
  python3 -m venv venv
  source venv/bin/activate
  ```

**4. 安装依赖**

项目所需的所有依赖都已在 `requirements.txt` 文件中列出。

```bash
pip install -r requirements.txt
```

**5. 运行应用**

```bash
python app.py
```

## 📖 使用说明

1.  **选择文件**:
    - 点击 **"点击选择文件"** 按钮，然后浏览并选择一个支持的音视频文件（如 `.mp3`, `.mp4`, `.wav`, `.mkv` 等）。
    - 或者，直接将单个文件拖拽到 "将音视频文件拖拽到此处" 的区域。
2.  **配置选项**:
    - **源语言**: 选择音频的主要语言。如果选择 "自动检测"，ElevenLabs API 会尝试自动识别。
    - **识别声音事件**: 勾选此项后，API会尝试识别并输出 `[音乐]`、`[掌声]` 等非语音事件。
    - **注意**: “每行最大字数”的设置已被移除。程序现在会根据所选语言自动应用最优的排版规则。
3.  **开始生成**:
    - 点击 **"生成字幕"** 按钮。
    - 应用将开始上传文件，你可以在进度条和日志区域看到当前状态。
4.  **完成**:
    - 任务成功后，会弹出成功的提示框。
    - 生成的 `.srt` 和 `.json` 文件会自动保存在与源音视频文件相同的目录下。

## 🛠️ 关于 ElevenLabs API

本工具使用 ElevenLabs 的语音转文本 API。当前版本的代码使用了允许**未经身份验证**的 API 端点，因此**不需要**手动配置 API 密钥。

请注意，API 的使用条款和限制可能会发生变化。如果将来需要 API 密钥，则需要修改 `api_client.py` 文件以包含您的密钥。